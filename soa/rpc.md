# 何为rpc
rpc的全称为remote procedure call，即远程过程调用。什么是过程调用，我们在java中的一个方法中调用另一个方法，这就是本地调用。那远程的含义是什么呢？当今的服务架构逐渐偏向微服务架构，一个庞大的系统可以被拆分为许多的子系统，子系统不在同一个机器上，它们之间通过网络通信完成某个交互的动作，这就是远程调用。所以，远程的调用，一定离不开网络编程，不然怎么实现两个机器间的交互呢？

所以，为了完成这样一个跨机器调用的动作，我认为一个rpc框架应该做到的最基本的两点：

* 对调用者屏蔽网络通信的细节，让他们更专注于业务逻辑的编写
* 让远程调用跟本地调用无差异

# rpc如何通信
rpc最重要的应该就是网络的通信，通信的设计需要考虑哪些东西呢？

既然是网络的通信，那一定离不开协议（这里需要一些网络基础），rpc要做的事两个系统之间的数据交互，我们就可以使用TCP来传输，保证数据的安全性和完整性。

所有的数据给到网卡传输，都是以二进制的形式传输的，但是我们远程调用方法的参数是基本类型或是一个对象，一个对象转换为二进制，这就涉及到**序列化**，并且这个过程是可逆的。

到这里就完成了吗？当然不是，网络环境是相当复杂的，如果一个很大的数据传输到数据链路层，有可能会被拆分很多个包发送，这就导致接受方拿到的数据具有不确定性，数据是拆了还是没拆，第N次发过来的数据到哪结束了，知道了一条完整的数据我才可以序列化。所以，这就需要我们的协议起作用了我们发送的时候，在协议中添加一些元素，比如这次发送数据包的长度还有类型，这样接受方接受到数据后可以通过这些信息进行拆包。一般来说，协议分的内容可以分为数据头和消息体。数据头一般用于身份标识，比如序列化类型，请求类型等。消息体一般存放业务参数信息。

接受方拿到这个请求后，根据序列化类型对二进制数据进行反序列化，从而拿到请求参数。
# 如何对用户屏蔽掉用的细节
上面说到过，用户掉用的时候应该像调用本地方法一样进行调用，答案就是代理，这里不考虑代理的细节。invoke方法中其实就是一个网络掉用，这样做就对用户屏蔽掉了细节
# 开始设计完整的rpc
我们已经对rpc有了一个简单的认识，但是中间的细节，还是值得好好设计一下的。设计某个东西我们往往是自顶向下的一种设计思路，现在不妨问自己一个问题：什么是rpc？我觉得100个人有100个答案，先说我的理解：rpc就是通过特定的网络协议、可逆的序列化方式、代理设计模式，实现让调用方如同本地调用一样实现两个不同机器间的调用，即远程过程调用。在我的理解中，我已经把rpc粗略的划分为了3个模块，协议模块，序列化模块，网络通信（网络通信用代理模式来实现）模块。
## 网络协议
上文提到过我使用TCP来进行传输，因为TCP的特性具有很强的可靠性，